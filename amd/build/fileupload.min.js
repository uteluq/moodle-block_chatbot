define(["jquery","core/str"],function(e,t){function l(){var e,t=document.querySelector(".block_uteluqchatbot #fileUploadModal");t&&(t.style.display="none"===t.style.display||""===t.style.display?"flex":"none","none"===t.style.display)&&(t=document.querySelector(".block_uteluqchatbot #fileUploadForm"),e=document.querySelector(".block_uteluqchatbot #uploadedFilesContainer"),t&&t.reset(),e&&(e.innerHTML=""),s=[])}function c(e){let d=document.querySelector(".block_uteluqchatbot #uploadedFilesContainer");d&&(d.innerHTML="",Array.from(e).forEach((a,e)=>{var t=10485760<(t=a).size?{valid:!1,message:get_string("file_size_exceeds_limit","block_uteluqchatbot")}:(l="."+t.name.split(".").pop().toLowerCase(),t=["application/pdf","text/plain"].includes(t.type)||""===t.type,l=[".txt",".text",".md",".pdf"].includes(l),t||l?{valid:!0}:{valid:!1,message:"Only PDF, TXT, TEXT, and MD files are allowed"});if(t.valid){var l=document.createElement("div"),n=(l.classList.add("uploaded-file"),document.createElement("div")),r=(n.style.display="flex",n.style.flexDirection="column",document.createElement("span")),i=(r.textContent=a.name,r.classList.add("file-name"),r.style.fontWeight="bold",document.createElement("span"));i.textContent=(a.size/1024/1024).toFixed(2)+" MB",i.classList.add("file-size"),i.style.fontSize="0.9em",i.style.color="#666";let o=document.createElement("button");o.type="button",o.classList.add("remove-file-btn"),o.setAttribute("aria-label","Remove file"),o.style.marginLeft="auto",o.innerHTML=`
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                    <path d="M19 6.41L17.59 5L12 10.59L6.41 5L5 6.41L10.59 12L5 17.59L6.41 19L12 13.41L17.59 19L19 17.59L13.41 12L19 6.41Z" fill="currentColor"/>
                </svg>
            `,o.addEventListener("click",e=>{e.stopPropagation();var e=o,t=a.name,l=document.querySelector(".block_uteluqchatbot #uploadedFilesContainer");if(l&&e.parentElement&&l.removeChild(e.parentElement),s=s.filter(e=>e.name!==t),l=document.querySelector(".block_uteluqchatbot #file")){let t=new DataTransfer;s.forEach(e=>t.items.add(e)),l.files=t.files,c(s)}}),n.appendChild(r),n.appendChild(i),l.appendChild(n),l.appendChild(o),d.appendChild(l)}else(r=document.createElement("div")).classList.add("file-error"),r.style.color="red",r.style.marginTop="10px",r.textContent=a.name+": "+t.message,d.appendChild(r)}))}let s=[];function o(){var e=document.querySelector(".block_uteluqchatbot #fileUploadModal");let n=document.querySelector(".block_uteluqchatbot #file");if(e&&n){let t=e.querySelector(".file-upload-container");function l(e){e.preventDefault(),e.stopPropagation()}function o(e){t.classList.add("highlight"),t.style.borderColor="#007bff",t.style.backgroundColor="#f8f9fa"}function a(e){t.classList.remove("highlight"),t.style.borderColor="#ccc",t.style.backgroundColor="transparent"}t&&(["dragenter","dragover","dragleave","drop"].forEach(e=>{t.addEventListener(e,l,!1),document.body.addEventListener(e,l,!1)}),["dragenter","dragover"].forEach(e=>{t.addEventListener(e,o,!1)}),["dragleave","drop"].forEach(e=>{t.addEventListener(e,a,!1)}),t.addEventListener("drop",function(e){let t=e.dataTransfer,l=t.files,o=Array.from(l),a=(o.forEach(t=>{s.find(e=>e.name===t.name)||s.push(t)}),new DataTransfer);s.forEach(e=>a.items.add(e)),n.files=a.files,c(s)},!1))}}return{init:function(){{let l=document.querySelector(".block_uteluqchatbot #file");var e=document.querySelector(".block_uteluqchatbot #uploadedFilesContainer");l&&e&&(l.addEventListener("change",function(e){Array.from(e.target.files).forEach(t=>{s.find(e=>e.name===t.name)||s.push(t)});let t=new DataTransfer;s.forEach(e=>t.items.add(e)),l.files=t.files,c(s)}),e=document.querySelector(".block_uteluqchatbot .file-upload-box"))&&e.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),l.click()})}o(),window.toggleFileUploadModal=l}}});