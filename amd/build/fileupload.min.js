define(["jquery","core/str"],function(e,t){function l(){var e,t=document.querySelector(".block_uteluqchatbot #fileUploadModal");t&&(t.style.display="none"===t.style.display||""===t.style.display?"flex":"none","none"===t.style.display)&&(t=document.querySelector(".block_uteluqchatbot #fileUploadForm"),e=document.querySelector(".block_uteluqchatbot #uploadedFilesContainer"),t&&t.reset(),e&&(e.innerHTML=""),c=[],console.log("Modal closed, files reset"))}function r(e){let d=document.querySelector(".block_uteluqchatbot #uploadedFilesContainer");d&&(d.innerHTML="",console.log(`Displaying ${e.length} files`),Array.from(e).forEach((n,e)=>{console.log(`Displaying file ${e+1}: `+n.name);e=10485760<(e=n).size?{valid:!1,message:"File size exceeds 10MB limit"}:(t="."+e.name.split(".").pop().toLowerCase(),e=["application/pdf","text/plain"].includes(e.type)||""===e.type,t=[".txt",".text",".md",".pdf"].includes(t),e||t?{valid:!0}:{valid:!1,message:"Only PDF, TXT, TEXT, and MD files are allowed"});if(e.valid){var t=document.createElement("div"),l=(t.classList.add("uploaded-file"),document.createElement("div")),a=(l.style.display="flex",l.style.flexDirection="column",document.createElement("span")),i=(a.textContent=n.name,a.classList.add("file-name"),a.style.fontWeight="bold",document.createElement("span"));i.textContent=(n.size/1024/1024).toFixed(2)+" MB",i.classList.add("file-size"),i.style.fontSize="0.9em",i.style.color="#666";let o=document.createElement("button");o.type="button",o.classList.add("remove-file-btn"),o.setAttribute("aria-label","Remove file"),o.style.marginLeft="auto",o.innerHTML=`
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                    <path d="M19 6.41L17.59 5L12 10.59L6.41 5L5 6.41L10.59 12L5 17.59L6.41 19L12 13.41L17.59 19L19 17.59L13.41 12L19 6.41Z" fill="currentColor"/>
                </svg>
            `,o.addEventListener("click",e=>{e.stopPropagation();var e=o,t=n.name,l=document.querySelector(".block_uteluqchatbot #uploadedFilesContainer");if(l&&e.parentElement&&l.removeChild(e.parentElement),c=c.filter(e=>e.name!==t),console.log("Removed file:",t,"Remaining files:",c.length),l=document.querySelector(".block_uteluqchatbot #file")){let t=new DataTransfer;c.forEach(e=>t.items.add(e)),l.files=t.files,r(c)}}),l.appendChild(a),l.appendChild(i),t.appendChild(l),t.appendChild(o),d.appendChild(t)}else(a=document.createElement("div")).classList.add("file-error"),a.style.color="red",a.style.marginTop="10px",a.textContent=n.name+": "+e.message,d.appendChild(a)}))}let c=[];function o(){var e=document.querySelector(".block_uteluqchatbot #fileUploadModal");let a=document.querySelector(".block_uteluqchatbot #file");if(e&&a){let t=e.querySelector(".file-upload-container");function l(e){e.preventDefault(),e.stopPropagation()}function o(e){t.classList.add("highlight"),t.style.borderColor="#007bff",t.style.backgroundColor="#f8f9fa"}function n(e){t.classList.remove("highlight"),t.style.borderColor="#ccc",t.style.backgroundColor="transparent"}t&&(["dragenter","dragover","dragleave","drop"].forEach(e=>{t.addEventListener(e,l,!1),document.body.addEventListener(e,l,!1)}),["dragenter","dragover"].forEach(e=>{t.addEventListener(e,o,!1)}),["dragleave","drop"].forEach(e=>{t.addEventListener(e,n,!1)}),t.addEventListener("drop",function(e){let t=e.dataTransfer,l=t.files,o=(console.log("Files dropped: "+l.length),Array.from(l)),n=(o.forEach(t=>{c.find(e=>e.name===t.name)||(c.push(t),console.log("Added dropped file:",t.name))}),new DataTransfer);c.forEach(e=>n.items.add(e)),a.files=n.files,r(c)},!1))}}return{init:function(){console.log("Initializing file upload module");{let l=document.querySelector(".block_uteluqchatbot #file");var e=document.querySelector(".block_uteluqchatbot #uploadedFilesContainer");l&&e?(l.addEventListener("change",function(e){console.log("File input changed, new files:",e.target.files.length),Array.from(e.target.files).forEach(t=>{c.find(e=>e.name===t.name)?console.log("File already exists:",t.name):(c.push(t),console.log("Added file:",t.name))});let t=new DataTransfer;c.forEach(e=>t.items.add(e)),l.files=t.files,console.log("Total accumulated files:",c.length),r(c)}),(e=document.querySelector(".block_uteluqchatbot .file-upload-box"))&&e.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),console.log("Upload box clicked, opening file selector"),l.click()})):console.log("File input or container not found")}o(),window.toggleFileUploadModal=l}}});